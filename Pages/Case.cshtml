@page
@using Microsoft.AspNetCore.Http
@model CaseModel
@{
    ViewData["Title"] = "Business case details";
}

<html>
    <head>
        <title>Business Case Details</title>
        <script src="js/site.js"></script>
    </head>
    <body>
        <!-- HttpContext.Request.Query gets the query string with the key "id" ("?id=X" from the URL), which we need in order to know what case to load -->
        <!-- id is saved as a string in the data model to avoid type conversion here -->
        <!-- we compare the ids for the cases in the database (or for now in the json file) and display it if it's found. IDs must be unique for this to work -->
        @foreach (var bcase in Model.Cases) { 
            @if (HttpContext.Request.Query["id"] == bcase.id) {
                Model.caseFound = true;
                <h1>@bcase.title</h1>
                <div class="case_debrief">
                    <div>
                        <h7 class="h7 center">@bcase.company</h7>
                        <p class="case_debrief_font">
                            <b>Keywords: </b> 
                            @bcase.tags
                        </p>
                        <p class="case_debrief_font">
                            <b>Country: </b> 
                            @bcase.country
                        </p>
                        <p class="case_debrief_font">
                            <b>Bounty: </b> 
                            CAD$ @bcase.bounty
                        </p>
                        <p class="case_debrief_font" id="datetime"></p>    
                        <script>
                            var datetime = convertEpoch(@bcase.datetime);
                            document.getElementById("datetime").innerHTML = "<b>Date Posted: </b>" + datetime;
                        </script>
                    </div>
                </div>
                <div>
                    <h2>Full Case</h2>
                    <div class="flex-wrapper">
                        <div class="box2">
                            <p class ="case_full_font">@bcase.description</p>
                        </div>
                    </div>
                </div>

                @if (string.IsNullOrEmpty(HttpContext.Session.GetString(CaseModel.SessionKeyEmail))) {
                    <div>
                        <h2>NEED TO ADD LOGIN CHECK FOR THIS DIV -- Respond to this business case</h2>
                        <div>
                            <form>
                                <textarea id="response" name="response" placeholder="Write your response..." style="height:300px"></textarea>
                            </form>
                            <br>
                        </div>  
                        <input type="submit" value="Submit Response">
                    </div>
                }
                <div>
                    <h2>Other Responses</h2>
                    @foreach (var response in bcase.Responses) { 
                        <div style="text-align: left;">
                            <div class="flex-wrapper">
                                <div class="box2">
                                    <h2 class="responder_name">@response.response_name</h2>
                                    <p class="responder_date" id="response_datetime"></p>    
                                    <script>
                                        var responseDatetime = convertEpoch(@response.datetime);
                                        document.getElementById("response_datetime").innerHTML = "<b>Date Posted: </b>" + response.response_Datetime;
                                    </script>
                                    <br>
                                    <p class ="case_full_font">@response.response_description</p> 
                                </div> 
                            </div>
                        </div>
                    }
                </div>
            }
        }
        @if (Model.caseFound == false) {
            <h1>Sorry, we can't find that business case.</h1>
            <div class="center"><button class="btn2" onclick="location.href='/Active';">Go back to active business cases</button></div>
        }
    </body>
</html>